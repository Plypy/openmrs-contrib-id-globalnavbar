<link rel="stylesheet" type="text/css" media="all"
		href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/themes/ui-darkness/jquery-ui.css"/>

<script type="text/javascript" 
		src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js">
	</script>

	<script type="text/javascript">
	$(function() {
		// mouseover param-control
		$('#param-control')
		.hide()
		.mouseenter(function() {
			$(this).show();
		})
		.find('li')
		.mouseenter(function() {
			$(this).addClass('ui-state-hover');
		})
		.mouseleave(function() {
			$(this).removeClass('ui-state-hover');
		});

		var paramRow = function(){
			return '<tr><% for (var j = 0; j < columns.length; j++) { %><td>'
				+'<input type="text" class="<%=columns[j].type%>" placeholder="<%=columns[j].value%>" name="'+($('tbody tr').length-1)+'-<%=columns[j].name%>"></td><% } %></tr>';
			};

		// initialize table
		$('table#params')
		//.append('<tr><th class="name">Name</th><th class="value">Value</th></tr>')
		.append(paramRow());

		// display/hide border
		$('#params')
		.delegate('input', 'focus', function() {
			//$(this).css({border: '1px solid #AAAAAA'});
			$('#param-control').hide();
		})
		.delegate('input', 'blur', function() {
			//$(this).css({border: 'none'});
		})
		.delegate('tr:gt(0)', 'mouseenter', function() {
			var theRow = $(this),
			    position = theRow.position();
			$('#param-control')
			.css({
				top: position.top + 9 + 'px',
				//left: position.left + 413 + 'px'
			})
			.show()
			.find('.add-param span')
			.unbind('click')
			.click(function() {
				$(paramRow())
				.insertAfter('tr:last-child')
				.find('input.name')
				.focus();
			})
			.end()
			.find('.delete-param span')
			.unbind('click')
			.click(function() {
				if (theRow.siblings().length > 1) {
					theRow.remove();
					$('#param-control').hide();
				}
			});
		});
	});
	</script>

<div id="params-container">
	<table id="params">
		<tr>
			<% for (var i = 0; i < columns.length; i++) { %>
			<th class="<%=columns[i].type%>"><%=columns[i].value%></th>
			<% } %>
		</tr>
		
		<% for (var i = 0; i < data.length; i++) { %>
		<tr>
			<% for (var j = 0; j < columns.length; j++) { %>
			<td>
				<input type="text" class="<%=columns[j].type%>" placeholder="<%=columns[j].value%>" name="<%=i%>-<%=columns[j].name%>" value="<%=data[i][columns[j].name]%>">
			</td><% } %>
		</tr>
		<% } %>
	</table>
	
	<ul id="param-control">
		<li class="ui-state-default ui-corner-all add-param" title="Add">
			<span class="ui-icon ui-icon-circle-plus">Add</span>
		</li>
		<li class="ui-state-default ui-corner-all delete-param" title="Delete">
			<span class="ui-icon ui-icon-circle-close">Delete</span>
		</li>
	</ul>
</div>